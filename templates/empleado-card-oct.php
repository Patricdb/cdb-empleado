<?php
/** Tarjeta empleado basada en SVG con contorno y textos */
if ( ! function_exists('cdb_empleado_get_card_data') ) return;

$empleado_id = $empleado_id ?? get_the_ID();
$data     = cdb_empleado_get_card_data( (int) $empleado_id );
$name     = $data['name'] ?? '';
$rank     = $data['rank_current'] ?? null;
$rank_str = is_numeric($rank) ? str_pad((string) (int) $rank, 2, '0', STR_PAD_LEFT) : 'ND';
$card_id  = 'empcard8-' . (int) $empleado_id;

$parts = preg_split('/\s+/', trim($name));
$line1 = mb_strtoupper( $parts[0] ?? '', 'UTF-8' );
$line2 = isset($parts[1]) ? mb_strtoupper( implode(' ', array_slice($parts,1)), 'UTF-8' ) : '';
?>

<div class="cdb-empcard8" role="region" aria-labelledby="<?php echo esc_attr($card_id); ?>">
  <svg viewBox="0 0 888 874" aria-label="<?php esc_attr_e('Tarjeta empleado', 'cdb-empleado'); ?>">
    <path fill-rule="evenodd" fill="none" stroke="rgb(102, 96, 78)" stroke-width="10"
   d="M233.000,0.1000 C331.324,0.1000 429.677,0.1000 528.000,0.1000 C557.330,0.1000 586.670,0.1000 616.000,0.1000 C628.230,0.998 645.660,-1.544 655.1000,1.1000 C666.223,5.504 672.103,14.102 679.000,21.000 C692.332,34.332 705.668,47.668 718.1000,61.000 C755.663,97.663 792.337,134.337 828.1000,170.1000 C840.666,182.666 852.334,194.334 864.000,205.1000 C869.656,211.655 876.818,216.990 880.1000,223.1000 C887.803,235.403 883.336,269.594 883.1000,286.1000 C883.1000,333.662 883.1000,380.338 883.1000,427.000 C883.1000,499.326 883.1000,571.674 883.1000,644.000 C881.072,654.286 872.664,660.337 865.1000,667.000 C853.335,679.665 840.665,692.335 828.000,705.000 C794.329,738.668 756.692,774.438 726.1000,805.1000 C712.539,821.372 697.895,836.104 682.1000,851.000 C675.403,858.597 668.588,868.552 657.1000,873.000 C644.164,878.813 608.407,875.001 589.1000,874.1000 C537.672,874.1000 485.328,874.1000 432.1000,874.1000 C386.671,874.1000 340.329,874.1000 294.000,874.1000 C277.876,875.002 243.789,878.122 231.000,874.000 C211.622,867.754 188.152,837.153 173.1000,823.000 C133.671,782.671 93.329,742.329 52.1000,702.000 C39.388,688.388 5.364,661.405 0.000,643.000 C0.000,506.014 0.000,368.986 0.000,232.000 C3.364,220.192 13.310,212.689 21.000,204.1000 C34.665,191.335 48.335,177.665 62.000,164.000 C113.995,111.672 166.005,59.328 217.1000,6.1000 C222.349,4.013 228.514,4.035 233.000,0.1000Z"/>
      <path fill="rgb(102, 96, 78)"
   d="M256.000,597.000 C256.667,587.001 257.333,576.999 258.000,566.1000 C256.648,563.641 251.743,559.358 250.000,555.1000 C245.659,547.637 242.429,537.332 241.000,526.1000 C237.697,526.889 234.922,526.460 233.000,525.000 C224.182,521.916 211.557,493.697 215.1000,478.000 C218.058,470.729 224.355,470.989 225.000,462.000 C219.491,453.510 222.187,420.450 225.000,410.1000 C232.942,384.314 247.346,368.473 272.1000,359.1000 C280.717,357.451 287.190,358.931 296.000,357.000 C304.886,355.053 318.729,355.662 327.1000,358.000 C361.856,366.539 379.380,380.789 388.000,415.000 C389.390,420.517 391.444,429.541 390.000,437.000 C389.000,447.332 387.1000,457.668 387.000,468.000 C391.843,469.356 394.576,472.093 394.1000,478.000 C397.805,482.238 395.050,491.911 393.1000,496.000 C388.757,516.429 389.026,520.942 369.1000,528.000 C369.245,540.143 363.383,553.166 358.000,561.1000 C356.667,563.333 355.333,564.667 354.000,565.1000 C354.667,576.332 355.333,586.668 355.1000,597.000 C370.660,598.807 384.827,605.997 396.1000,611.000 C427.602,623.579 456.621,633.424 473.000,660.000 C482.202,674.931 482.086,694.403 487.000,714.000 C498.085,758.207 499.935,810.527 500.000,863.1000 C512.075,867.978 532.861,865.000 547.000,865.000 C581.330,865.000 615.670,865.000 649.1000,865.000 C652.858,862.974 657.040,863.003 660.000,861.000 C667.333,853.334 674.667,845.666 682.000,838.000 C700.513,819.485 718.582,800.621 737.000,782.000 C761.520,757.210 786.342,732.657 810.1000,708.000 C825.665,693.335 840.335,678.665 854.1000,663.1000 C861.220,657.781 870.672,651.813 873.1000,643.000 C878.263,631.709 875.001,603.201 875.000,588.1000 C875.000,547.671 875.000,506.329 875.000,464.1000 C875.000,411.005 875.000,356.995 875.000,302.1000 C875.000,286.335 875.000,269.665 875.000,252.1000 C874.667,246.001 874.333,238.999 873.1000,232.000 C871.435,224.880 863.965,219.965 858.1000,215.000 C847.668,203.668 836.332,192.332 825.000,181.000 C785.004,141.004 744.996,100.996 704.1000,61.000 C692.034,48.033 665.806,14.599 647.1000,9.1000 C539.344,9.1000 430.656,9.1000 322.000,9.1000 C306.241,7.289 275.145,9.797 264.000,10.1000 C253.731,12.108 238.354,7.882 228.1000,11.1000 C218.121,16.790 198.257,41.742 189.000,50.1000 C159.003,80.997 128.997,111.003 99.000,141.000 C78.335,161.665 57.665,182.335 37.000,203.000 C28.378,211.622 14.184,220.525 10.000,233.000 C5.579,246.180 8.999,268.706 8.1000,284.000 C8.1000,320.996 8.1000,358.004 8.1000,394.1000 C8.1000,451.994 8.1000,509.006 8.1000,565.1000 C8.1000,583.665 8.1000,601.335 8.1000,618.1000 C8.999,626.604 7.961,635.885 10.000,641.1000 C14.272,654.810 29.136,664.136 38.000,673.000 C56.998,691.998 76.002,711.002 95.000,730.000 C101.523,736.523 112.047,751.238 120.000,754.1000 C120.000,752.000 120.000,748.1000 120.000,746.000 C122.142,742.353 120.867,736.801 121.1000,731.1000 C125.392,717.625 127.270,690.259 134.000,672.000 C146.701,637.544 179.588,626.003 212.1000,611.1000 C225.921,606.584 240.438,598.922 256.000,597.000Z"/>

    <g class="t" text-anchor="middle">
      <text class="t name" x="50%" y="155" font-size="90" id="<?php echo esc_attr($card_id); ?>">
        <tspan x="50%" dy="0"><?php echo esc_html($line1); ?></tspan>
        <?php if ( $line2 ) : ?>
        <tspan x="50%" dy="88"><?php echo esc_html($line2); ?></tspan>
        <?php endif; ?>
      </text>
    </g>
    <g class="t t--small" text-anchor="start">
      <text class="puesto" x="620" y="320" font-size="40"><?php esc_html_e('Puesto', 'cdb-empleado'); ?></text>
      <text class="num" x="620" y="540" font-size="180" font-weight="900"><?php echo esc_html($rank_str); ?></text>
    </g>
  </svg>
</div>

